#!/usr/bin/env sh
set -eu

set -o pipefail

ROOT_DIR="$(cd "$(dirname "$0")/.." && pwd)"
cd "$ROOT_DIR/apps/server"

if [ -n "${JAVA_HOME:-}" ]; then
  echo "[pre-commit] Using JAVA_HOME=$JAVA_HOME"
fi

echo "[pre-commit] Running ktlintFormat (strict mode)"
./gradlew ktlintFormat

echo "[pre-commit] Ensure formatter changes are committed"
if ! git diff --exit-code --quiet; then
  echo "[pre-commit] ktlintFormat modified files. Please re-add changes and commit again."
  exit 1
fi

echo "[pre-commit] Running ktlintCheck"
./gradlew ktlintCheck
